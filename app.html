<!doctype html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linder â€” ReadLater+ App</title>

  <!-- Base styles (í™ˆê³¼ ë™ì¼ í°íŠ¸/í…œí”Œë¦¿) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link href="css/bootstrap-icons.css" rel="stylesheet" />
  <link href="css/templatemo-tiya-golf-club.css" rel="stylesheet" />

  <style>
    :root {
      --ink: #3D405B;
      /* í™ˆ ìƒë‹¨ë°” ì¸ë””ê³  */
      --accent: #F2CC8F;
      /* í™ˆì˜ ë…¸ë€ í¬ì¸íŠ¸ */
      --accent-ink: #111827;
      --sky: #F7FBFF;
      /* ì‚´ì§ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
      --card: #ffffff;
      --border: #ececf3;
    }

    body {
      font-family: "DM Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--sky);
      font-size: 1.06rem;
      color: #0f172a;
    }

    /* ===== Top Bar (í™ˆ ìƒ‰ìƒ ì ìš©, ì„¤ëª… ì œê±°) ===== */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 1030;
      background: var(--ink);
      border-bottom: 1px solid rgba(255, 255, 255, .06);
      box-shadow: 0 4px 16px rgba(0, 0, 0, .08);
    }

    .topbar .brand-link {
      color: #fff;
      text-decoration: none;
    }

    .brand-mark {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 12px;
      background: linear-gradient(135deg, #f2f4f8, #e6eefc);
      border: 1px solid rgba(0, 0, 0, .06);
      margin-right: .6rem
    }

    .brand-mark i {
      font-size: 1.1rem;
      color: #2b2f36
    }

    /* ìƒë‹¨ í† ê¸€ (ì•ˆì½ìŒ/ì½ìŒ) */
    .segmented {
      display: inline-flex;
      gap: 6px;
      padding: 6px;
      border-radius: 999px;
      background: rgba(255, 255, 255, .12);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, .18)
    }

    .segmented .btn {
      border-radius: 999px;
      border: 0;
      padding: .45rem .95rem;
      font-weight: 700;
      color: rgba(255, 255, 255, .85);
      background: transparent
    }

    .segmented .btn.active {
      background: #fff;
      color: var(--ink);
      box-shadow: 0 2px 4px rgba(0, 0, 0, .12)
    }

    /* ===== ì…ë ¥/ì •ë ¬ ì„¹ì…˜ (í™ˆ ëŠë‚Œ, ë…¸ë€ í¬ì¸íŠ¸) ===== */
    .section-controls {
      background: var(--card);
      border-bottom: 1px solid #e8edf6
    }

    .section-padding {
      padding-top: 36px;
      padding-bottom: 36px
    }

    .form-control,
    .form-select {
      border-radius: 14px
    }

    .input-group-text {
      border-radius: 14px 0 0 14px
    }

    .btn-round {
      border-radius: 14px
    }

    .btn-primary {
      --bs-btn-bg: var(--accent);
      --bs-btn-border-color: var(--accent);
      --bs-btn-color: var(--accent-ink);
      --bs-btn-hover-bg: #e9be7e;
      --bs-btn-hover-border-color: #e9be7e;
      --bs-btn-hover-color: var(--accent-ink);
    }

    .btn-outline-primary {
      --bs-btn-color: var(--accent);
      --bs-btn-border-color: var(--accent);
      --bs-btn-hover-bg: var(--accent);
      --bs-btn-hover-border-color: var(--accent);
      --bs-btn-hover-color: var(--accent-ink);
      color: var(--accent);
      border-color: var(--accent);
    }

    /* ë³´ê¸°/ì •ë ¬ í† ê¸€(ë³¸ë¬¸) */
    .chips {
      display: inline-flex;
      gap: 6px;
      padding: 6px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid var(--border)
    }

    .chips .btn {
      border-radius: 999px;
      border: 0;
      padding: .42rem .9rem;
      font-weight: 600;
      color: #334155;
      background: transparent
    }

    .chips .btn.active {
      background: var(--accent);
      color: var(--accent-ink);
      box-shadow: 0 1px 3px rgba(0, 0, 0, .12)
    }

    /* ===== ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ ===== */
    #listRoot {
      display: grid;
      gap: 1.25rem
    }

    #listRoot.cols-1 {
      grid-template-columns: 1fr
    }

    #listRoot.cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr))
    }

    #listRoot.cols-3 {
      grid-template-columns: repeat(3, minmax(0, 1fr))
    }

    @media (max-width: 991.98px) {
      #listRoot.cols-3 {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    @media (max-width: 767.98px) {

      #listRoot.cols-2,
      #listRoot.cols-3 {
        grid-template-columns: 1fr
      }
    }

    /* ì¹´ë“œ/íƒœê·¸ */
    .doc-card {
      background: #fff;
      border-radius: 20px;
      border: 1px solid var(--border);
      transition: transform .18s ease, box-shadow .2s ease
    }

    .doc-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 14px 28px rgba(0, 0, 0, .08)
    }

    .tag {
      font-size: .75rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      border: 1px solid;
      white-space: nowrap
    }

    .t-cook {
      background: #fff7ed;
      color: #9a3412;
      border-color: #fed7aa
    }

    .t-dl {
      background: #f3e8ff;
      color: #6b21a8;
      border-color: #e9d5ff
    }

    .t-sci {
      background: #eff6ff;
      color: #1d4ed8;
      border-color: #dbeafe
    }

    .t-dev {
      background: #ecfdf5;
      color: #047857;
      border-color: #d1fae5
    }

    .t-health {
      background: #fdf2f8;
      color: #9d174d;
      border-color: #fbcfe8
    }

    .t-etc {
      background: #f3f4f6;
      color: #374151;
      border-color: #e5e7eb
    }

    /* ì˜¤ë¥¸ìª½ 3ë²„íŠ¼ ë™ì¼í­ */
    .action-btn {
      min-width: 140px;
      white-space: nowrap
    }

    @media (max-width:991.98px) {
      .action-btn {
        width: 100%
      }
    }

    /* ë¹ˆ ìƒíƒœ */
    .empty-illustr {
      width: 96px;
      height: 96px;
      border-radius: 999px;
      background: #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem auto;
      color: #9ca3af;
      font-size: 34px
    }

    /* ë¬¸ì„œ ì„¹ì…˜ ë‚´ë¶€ ë¸Œëœë“œ ë¸”ë¡ */
    .brand-footer {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 16px
    }

    #tagFilterButtons .btn.active {
      background: var(--accent);
      color: var(--accent-ink);
      border-color: var(--accent);
    }
  </style>
</head>

<body>
  <!-- ===== Top Bar (í™ˆ ìƒ‰ìƒ/ë¡œê³ ë§Œ, ì„¤ëª… ì œê±°) ===== -->
  <header class="topbar">
    <div class="container py-3">
      <div class="d-flex align-items-center justify-content-between gap-3">
        <a href="index.html" class="brand-link d-flex align-items-center">
          <span class="brand-mark"><i class="bi-file-earmark-text"></i></span>
          <span class="fw-bold fs-4">Linder</span>
        </a>

        <div class="segmented" id="tabToggle" role="tablist" aria-label="ì½ìŒ í† ê¸€">
          <button class="btn active" data-tab="UNREAD">ì•ˆ ì½ìŒ</button>
          <button class="btn" data-tab="read">ì½ìŒ</button>
        </div>
      </div>
    </div>
  </header>

  <!-- ===== ì…ë ¥/ì •ë ¬ ì»¨íŠ¸ë¡¤ (í™ˆ í†¤ + ë…¸ë€ í¬ì¸íŠ¸) ===== -->
  <section class="section-controls section-padding">
    <div class="container">
      <div class="row g-3 align-items-center">
        <div class="col-12 col-lg-6">
          <div class="input-group">
            <span class="input-group-text bg-white"><i class="bi-link-45deg"></i></span>
            <input id="urlInput" type="url" class="form-control" placeholder="ì›¹ URLì„ ì…ë ¥í•˜ì„¸ìš”" />
          </div>
        </div>

        <div class="col-6 col-lg-2">
          <select id="topicSelect" class="form-select">
            <option>ìë™ ê°ì§€</option>
            <option>êµìœ¡</option>
            <option>ê²Œì„</option>
            <option>íŒ¨ì…˜</option>
            <option>ë·°í‹°</option>
            <option>ìŠ¤í¬ì¸ </option>
            <option>ê²½ì œ</option>
            <option>IT</option>
          </select>
        </div>

        <!-- ìˆ«ì ëŒ€ì‹  ë‹¬ë ¥: ê¸°ë³¸ê°’ = ì˜¤ëŠ˜+14 -->
        <div class="col-6 col-lg-2">
          <div class="input-group">
            <span class="input-group-text bg-white"><i class="bi-calendar3"></i></span>
            <input id="remindPicker" type="date" class="form-control" />
          </div>
        </div>

        <div class="col-12 col-lg-2">
          <button id="addBtn" class="btn btn-primary w-100 btn-round">ì¶”ê°€</button>
        </div>

        <!-- ì •ë ¬ Â· ë³´ê¸° í† ê¸€ -->
        <div class="col-12 mt-1">
          <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
            <div class="d-flex align-items-center gap-2">
              <span class="text-muted small">ì •ë ¬</span>
              <div class="chips" id="sortToggle" aria-label="ì •ë ¬">
                <button class="btn active" data-sort="date_desc">ë‚ ì§œ(ìµœì‹ )</button>
                <button class="btn" data-sort="date_asc">ë‚ ì§œ(ì˜¤ë˜ëœ)</button>
                <button class="btn" data-sort="tag">íƒœê·¸</button>
              </div>
            </div>

            <div class="d-flex align-items-center gap-2">
              <span class="text-muted small">ë³´ê¸°</span>
              <div class="chips" id="viewToggle" aria-label="ë³´ê¸°ì—´ìˆ˜">
                <button class="btn active" data-cols="1">1ì—´</button>
                <button class="btn" data-cols="2">2ì—´</button>
                <button class="btn" data-cols="3">3ì—´</button>
              </div>
            </div>
          </div>
        </div>
        <!-- ì •ë ¬ í† ê¸€ í´ë¦­ ì‹œ tagMode ì²˜ë¦¬ + í•„í„° ë Œë”ë§ -->
        <div class="col-12 mt-2" id="tagFilterRow" style="display:none;">
          <div class="d-flex flex-wrap align-items-center gap-2">
            <span class="text-muted small">íƒœê·¸ ì„ íƒ</span>
            <div id="tagFilterButtons" class="d-flex flex-wrap gap-2"></div>
          </div>
        </div>


        <div class="col-12">
          <small class="text-muted">
            â€» í˜„ì¬ ì¿ í‚¤ë¡œ ë¡œê·¸ì¸ í•˜ì…¨ìŠµë‹ˆë‹¤! URLì„ ì…ë ¥í•˜ë©´ ì‹¤ì œ í˜ì´ì§€ì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ AIê°€ ì œëª©ê³¼ ìš”ì•½ì„ ì €ì¥í•©ë‹ˆë‹¤.
            ë§í¬ë¥¼ í•˜ë‚˜ë¼ë„ ì…ë ¥í•˜ì‹œë©´ ë°ëª¨ ë§í¬ëŠ” ì‚¬ë¼ì§€ë©°, ë¦¬ë§ˆì¸ë“œ ë‚ ì§œëŠ” ê¸°ë³¸ìœ¼ë¡œ <strong>14ì¼ ë’¤</strong>ê°€ ì„ íƒë©ë‹ˆë‹¤. ë‹¬ë ¥ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”.
          </small>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== ëª©ë¡ ===== -->
  <section class="section-padding">
    <div class="container">
      <div id="listRoot" class="cols-1"></div>

      <div id="emptyState" class="text-center py-5 d-none">
        <div class="empty-illustr"><i class="bi-book"></i></div>
        <h5 class="mb-1" id="emptyTitle">ì•„ì§ ì €ì¥í•œ ê¸€ì´ ì—†ì–´ìš”</h5>
        <p class="text-muted">ìœ„ì—ì„œ ë§í¬ë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
      </div>

      <!-- ë¬¸ì„œ ì„¹ì…˜ ë‚´ë¶€ì˜ ë¸Œëœë“œ ë¸”ë¡ (ìš”ì²­ëŒ€ë¡œ ìœ ì§€) -->
      <div class="brand-footer mt-5 p-4 text-center">
        <div class="d-inline-flex align-items-center gap-2">
          <span class="brand-mark"><i class="bi-file-earmark-text"></i></span>
          <div class="text-start">
            <div class="fw-bold">Linder</div>
            <div class="small text-muted">ReadLater+</div>
          </div>
        </div>
        <div class="text-muted small mt-2">Copyright Â© Linder</div>
      </div>
    </div>
  </section>


  <!-- í™ˆê³¼ ë™ì¼í•œ íŒŒë„ ë°°ê²½ ìƒ‰ìƒ -->
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
    <path fill="#81B29A" fill-opacity="1"
      d="M0,224L34.3,192C68.6,160,137,96,206,90.7C274.3,85,343,139,411,144C480,149,549,107,617,122.7C685.7,139,754,213,823,240C891.4,267,960,245,1029,224C1097.1,203,1166,181,1234,160C1302.9,139,1371,117,1406,106.7L1440,96L1440,320L1405.7,320C1371.4,320,1303,320,1234,320C1165.7,320,1097,320,1029,320C960,320,891,320,823,320C754.3,320,686,320,617,320C548.6,320,480,320,411,320C342.9,320,274,320,206,320C137.1,320,69,320,34,320L0,320Z">
    </path>
  </svg>
  </footer>

  <!-- ===== JS (ê¸°ëŠ¥ ê·¸ëŒ€ë¡œ + ë°±ì—”ë“œ ì—°ë™) ===== -->
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="js/bootstrap.bundle.min.js"></script>

  <script>
    /* =========================
       ê³µí†µ ìœ í‹¸ (ì¿ í‚¤, ë‚ ì§œ)
    ========================== */

    function getCookieValue(name) {
      const value = "; " + document.cookie;
      const parts = value.split("; " + name + "=");
      if (parts.length === 2) {
        return parts.pop().split(";").shift();
      }
    }

    function setCookieValue(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getUVfromCookie() {
      const existingHash = getCookieValue("user");
      if (existingHash) return existingHash;
      const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
      setCookieValue("user", hash, 180);
      return hash;
    }

    function todayISO() {
      const d = new Date();
      return d.toISOString().slice(0, 10);
    }

    function addDaysISO(days) {
      const d = new Date();
      d.setDate(d.getDate() + days);
      return d.toISOString().slice(0, 10);
    }

    /* =========================
       ìƒíƒœ & ìœ í‹¸
    ========================== */

    let articles = [];                 // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ + ìƒˆë¡œ ì¶”ê°€í•œ ë°ì´í„°
    let activeTab = "UNREAD";          // 'UNREAD' | 'read'
    let sortMode = "date_desc";        // 'date_desc' | 'date_asc' | 'tag'
    let layoutCols = 1;                // 1 | 2 | 3
    let tagFilterActive = false;
    let activeTagsForFilter = new Set();  // ì„ íƒëœ íƒœê·¸ë“¤


    const $ = (s, r = document) => r.querySelector(s);
    const $$ = (s, r = document) => Array.from(r.querySelectorAll(s));

    const host = (u) => { try { return new URL(u).hostname } catch { return "unknown" } };

    const ALL_TAGS = [
      "ë‰´ìŠ¤", "êµìœ¡", "ì½”ë¯¸ë””", "ì¼ìƒ", "ê²Œì„", "ìŒì•…", "ì˜í™”", "ìŠ¤í¬ì¸ ", "íŒ¨ì…˜", "ë·°í‹°", "ê¸°ìˆ ", "ìŒì‹", "ì—¬í–‰", "ê±´ê°•", "ê³¼í•™", "ì—­ì‚¬",
      "ì •ì¹˜", "ê²½ì œ", "ì¬í…Œí¬", "ìê¸°ê³„ë°œ", "ì˜ˆìˆ ", "ë°˜ë ¤ë™ë¬¼", "í™˜ê²½", "ë¦¬ë·°", "ê³µì˜ˆ", "ì·¨ë¯¸", "ì˜¤ë””ì˜¤", "íŒŸìºìŠ¤íŠ¸", "ë§Œí™”", "ì•„ë™", "ì¢…êµ",
      "ë¬¸í™”", "ì‡¼í•‘", "ë¶€ë™ì‚°", "ë²•ë¥ ", "ì˜í•™", "IT", "ë¬¸í•™", "ì‹œì‚¬", "ì¡°ë¦¬", "íë§", "ASMR"
    ];

    // ë¹„ìŠ·í•œ íƒœê·¸ë¼ë¦¬ 3~4ê°œ ì •ë„ ë¬¶ì–´ì„œ ê°™ì€ ìƒ‰ì„ ì“°ë„ë¡ ê·¸ë£¹í™”
    const cookTags = ["ìŒì‹", "ì¡°ë¦¬", "ì—¬í–‰", "ì‡¼í•‘", "ë¦¬ë·°", "íë§", "ASMR"];               // t-cook (ë”°ëœ»í•œ ì˜¤ë Œì§€í†¤)
    const dlTags = ["ê¸°ìˆ ", "IT", "ê²½ì œ", "ì¬í…Œí¬", "ë¶€ë™ì‚°", "ë²•ë¥ ", "ë‰´ìŠ¤", "ì‹œì‚¬"];        // t-dl (ê¸°ìˆ Â·ë””ì§€í„¸Â·ê²½ì œ)
    const sciTags = ["ê³¼í•™", "êµìœ¡", "ì—­ì‚¬", "ìê¸°ê³„ë°œ", "ì •ì¹˜", "ë¬¸í•™"];                     // t-sci (í•™ë¬¸Â·ì§€ì‹)
    const devTags = ["ê²Œì„", "ìŒì•…", "ì˜í™”", "ì½”ë¯¸ë””", "ì˜ˆìˆ ", "ê³µì˜ˆ", "ì·¨ë¯¸",
      "ë§Œí™”", "ì˜¤ë””ì˜¤", "íŒŸìºìŠ¤íŠ¸", "íŒ¨ì…˜", "ë·°í‹°", "ë¬¸í™”"];                  // t-dev (ì—”í„°Â·ì·¨ë¯¸Â·ë¼ì´í”„ìŠ¤íƒ€ì¼)
    const healthTags = ["ê±´ê°•", "í™˜ê²½", "ì˜í•™", "ìŠ¤í¬ì¸ ", "ë°˜ë ¤ë™ë¬¼", "ì•„ë™"];                 // t-health (ê±´ê°•Â·ë¼ì´í”„ì¼€ì–´)
    const etcTags = ["ì¼ìƒ", "ì¢…êµ"];                                                         // t-etc (ê·¸ ì™¸)

    const TAG_CLASS_MAP = {};

    cookTags.forEach(t => TAG_CLASS_MAP[t] = "t-cook");
    dlTags.forEach(t => TAG_CLASS_MAP[t] = "t-dl");
    sciTags.forEach(t => TAG_CLASS_MAP[t] = "t-sci");
    devTags.forEach(t => TAG_CLASS_MAP[t] = "t-dev");
    healthTags.forEach(t => TAG_CLASS_MAP[t] = "t-health");
    etcTags.forEach(t => TAG_CLASS_MAP[t] = "t-etc");

    const tagClass = (t) => {
      // ALL_TAGS ì•ˆì— ìˆëŠ” íƒœê·¸ëŠ” ì „ë¶€ ì—¬ê¸°ì„œ ìƒ‰ìƒì´ ë§¤í•‘ë¨
      return TAG_CLASS_MAP[t] || "t-etc";
    };



    const uniq = (arr) => [...new Set(arr)].slice(0, 3);

    // ë¦¬ë§ˆì¸ë“œ ê¸°ë³¸ê°’ = ì˜¤ëŠ˜ + 14ì¼
    (function initRemindPicker() {
      const p = $("#remindPicker");
      const now = new Date();
      const d = new Date(now); d.setDate(now.getDate() + 14);
      p.value = d.toISOString().slice(0, 10);
      p.min = now.toISOString().slice(0, 10);
    })();

    // Apps Script ì—”ë“œí¬ì¸íŠ¸ (index.htmlì—ì„œ ì“°ë˜ ê²ƒê³¼ ë™ì¼í•˜ê²Œ ë§ì¶”ê¸°)
    const addrScript = 'https://script.google.com/macros/s/AKfycbwHUTjWnUxfzURmCz7X8n_Ot38FqdtUgDAnjBjak6FNrXhiVxJZmQf8af-aFqfbUbfuDg/exec';


    /* =========================
       ì„œë²„ í†µì‹ : webs READ
       - user_id == ë‚˜ OR is_demo == 1
       - ì„œë²„ì—ì„œ í•„í„°ë§í•´ì„œ ë‚´ë ¤ì˜´
    ========================== */

    async function loadArticlesFromServer() {
      const userId = getUVfromCookie();

      try {
        const res = await axios.get(
          addrScript + '?action=read&table=webs&user_id=' + encodeURIComponent(userId)
        );
        const list = res.data && res.data.data ? res.data.data : [];

        // webs ì‹œíŠ¸ â†’ articles í˜•ì‹ìœ¼ë¡œ ë§ì¶”ê¸°
        articles = list
          .filter(row => row.status !== "2")   // ì†Œí”„íŠ¸ ì‚­ì œëœ ê²ƒì€ ì œì™¸
          .map(row => ({
            id: String(row.id),
            user_id: row.user_id,
            is_demo: Number(row.is_demo) || 0,
            url: row.url,
            title: row.title,
            summary: row.summary,
            tags: row.tags ? String(row.tags).split(",").map(s => s.trim()).filter(Boolean) : [],
            status: String(row.status),
            added_at: row.added_at ? String(row.added_at).slice(0, 10) : todayISO(),
            remind_at: row.remind_at ? String(row.remind_at).slice(0, 10) : ""
          }));

        render();
      } catch (err) {
        console.error('ì›¹ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨', err);
        // ì‹¤íŒ¨í•´ë„ ë°ëª¨ ì—†ì´ ë¹ˆ ìƒíƒœë¡œë¼ë„ ë™ì‘í•˜ë„ë¡
        articles = [];
        render();
      }
    }

    /* =========================
       ì„œë²„ í†µì‹ : webs INSERT + Gemini
       - í”„ë¡ íŠ¸ì—ì„œ url, user_topic, remind_at, user_id ë³´ë‚´ê¸°
       - ì„œë²„ê°€ title/summary/tags ì±„ì›Œì„œ websì— ì €ì¥ í›„ JSON ë°˜í™˜
    ========================== */

    async function addArticle() {
      const url = $("#urlInput").value.trim();
      const sel = $("#topicSelect").value;            // "ìë™ ê°ì§€" / êµìœ¡ / ê²Œì„ / íŒ¨ì…˜ / ë·°í‹° / ìŠ¤í¬ì¸  / ê²½ì œ / IT
      const remindAt = $("#remindPicker").value;
      const userId = getUVfromCookie();

      if (!url) return;

      const btn = $("#addBtn");
      btn.disabled = true;
      btn.innerText = "ì¶”ê°€ ì¤‘...";

      try {
        const payload = {
          user_id: userId,
          url: url,
          user_topic: sel,           // ì‚¬ìš©ìê°€ ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ (ìë™ ê°ì§€ í¬í•¨)
          remind_at: remindAt
        };

        const res = await axios.get(
          addrScript + '?action=insert_web'
          + '&table=webs'
          + '&data=' + encodeURIComponent(JSON.stringify(payload))
        );

        const record = res.data && res.data.data ? res.data.data : null;
        if (!record) throw new Error("ì„œë²„ì—ì„œ dataê°€ ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");

        const a = {
          id: String(record.id),
          user_id: record.user_id,
          is_demo: Number(record.is_demo) || 0,
          url: record.url,
          title: record.title,
          summary: record.summary,
          tags: record.tags ? String(record.tags).split(",").map(s => s.trim()).filter(Boolean) : [],
          status: String(record.status),
          added_at: record.added_at || todayISO(),
          remind_at: record.remind_at || ""
        };

        articles.unshift(a);
        $("#urlInput").value = "";
        render();
      } catch (err) {
        console.error("ë§í¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜", err);
        alert("ë§í¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
      } finally {
        btn.disabled = false;
        btn.innerText = "ì¶”ê°€";
      }
    }

    /* =========================
       ì„œë²„ í†µì‹ : webs UPDATE (statusë§Œ)
    ========================== */

    async function updateArticleStatusOnServer(id, newStatus) {
      try {
        const data = { status: newStatus };

        await axios.get(
          addrScript
          + '?action=update'
          + '&table=webs'
          + '&id=' + encodeURIComponent(id)
          + '&data=' + encodeURIComponent(JSON.stringify(data))
        );
      } catch (err) {
        console.error("ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (id=" + id + ")", err);
      }
    }


    /* =========================
       ë™ì‘: ì½ìŒ / ì‚­ì œ / ë³µì‚¬
    ========================== */

    function markAsRead(id) {
      articles = articles.map(a => a.id === id ? { ...a, status: "0" } : a);
      render();

      const a = articles.find(x => x.id === id);
      if (!a) return;
      if (Number(a.is_demo) === 1) {
        // demoë©´ ì„œë²„ì— ë°˜ì˜ ì•ˆ í•¨
        return;
      }
      updateArticleStatusOnServer(id, "0");
    }

    function softDelete(id) {
      articles = articles.map(a => a.id === id ? { ...a, status: "2" } : a);
      render();

      const a = articles.find(x => x.id === id);
      if (!a) return;
      if (Number(a.is_demo) === 1) {
        return;
      }
      updateArticleStatusOnServer(id, "2");
    }


    async function copyUrl(url, btn) {
      try {
        await navigator.clipboard.writeText(url);
        const prev = btn.innerHTML;
        btn.innerHTML = '<i class="bi-check-lg me-1"></i>ë³µì‚¬ë¨';
        setTimeout(() => btn.innerHTML = prev, 900);
      } catch {
        // quietly ignore
      }
    }

    /* =========================
       ì •ë ¬
    ========================== */

    function sortArticles(list) {
      // ìˆ«ìë¡œ ë¹„êµí•  ìˆ˜ ìˆê²Œ idë¥¼ Numberë¡œ ìºìŠ¤íŒ…
      const toNum = (x) => {
        const n = Number(x);
        return isNaN(n) ? 0 : n;
      };

      if (sortMode === "date_desc") {
        list.sort((a, b) => {
          if (a.added_at === b.added_at) {
            // ê°™ì€ ë‚ ì§œë©´ idê°€ í° ìˆœ (ë‚´ë¦¼ì°¨ìˆœ)
            return toNum(b.id) - toNum(a.id);
          }
          // ë‚ ì§œ ìµœì‹ ìˆœ: í° ë‚ ì§œê°€ ë¨¼ì €
          return a.added_at < b.added_at ? 1 : -1;
        });

      } else if (sortMode === "date_asc") {
        list.sort((a, b) => {
          if (a.added_at === b.added_at) {
            // ê°™ì€ ë‚ ì§œë©´ idê°€ ì‘ì€ ìˆœ
            return toNum(a.id) - toNum(b.id);
          }
          // ë‚ ì§œ ì˜¤ë˜ëœ ìˆœ: ì‘ì€ ë‚ ì§œê°€ ë¨¼ì €
          return a.added_at > b.added_at ? 1 : -1;
        });

      } else if (sortMode === "tag") {
        list.sort((a, b) => {
          const ta = (a.tags && a.tags[0]) || "";
          const tb = (b.tags && b.tags[0]) || "";
          if (ta === tb) {
            // íƒœê·¸ë„ ê°™ìœ¼ë©´ id ìˆœìœ¼ë¡œ
            return toNum(a.id) - toNum(b.id);
          }
          return ta > tb ? 1 : -1;
        });
      }

      return list;
    }

    $$("#sortToggle .btn").forEach(btn => btn.addEventListener("click", () => {
      sortMode = btn.dataset.sort;

      // sort ë²„íŠ¼ active ì²˜ë¦¬
      $$("#sortToggle .btn").forEach(b => b.classList.toggle("active", b === btn));

      if (sortMode === "tag") {
        tagFilterActive = true;
        buildTagFilterFromArticles();
      } else {
        tagFilterActive = false;
        $("#tagFilterRow").style.display = "none";
      }

      render();
    }));

    // í˜„ì¬ articlesì—ì„œ íƒœê·¸ ëª¨ìŒ â†’ ë²„íŠ¼ ìƒì„±
    function buildTagFilterFromArticles() {
      // í˜„ì¬ articlesì—ì„œ íƒœê·¸ ëª¨ë‘ ìˆ˜ì§‘
      const tagSet = new Set();
      articles.forEach(a => {
        (a.tags || []).forEach(t => tagSet.add(t));
      });

      const tags = Array.from(tagSet);
      const row = $("#tagFilterRow");
      const container = $("#tagFilterButtons");
      container.innerHTML = "";

      if (tags.length === 0) {
        row.style.display = "none";
        activeTagsForFilter = new Set();
        return;
      }

      // ê¸°ë³¸: ëª¨ë“  íƒœê·¸ ì„ íƒ ìƒíƒœ
      activeTagsForFilter = new Set(tags);

      tags.forEach(t => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "btn btn-sm btn-outline-secondary";
        btn.dataset.tag = t;
        btn.textContent = t;
        btn.classList.add("active"); // UIìƒ ì„ íƒë¨ í‘œì‹œ

        btn.addEventListener("click", () => {
          if (activeTagsForFilter.has(t)) {
            activeTagsForFilter.delete(t);
            btn.classList.remove("active");
          } else {
            activeTagsForFilter.add(t);
            btn.classList.add("active");
          }
          render();
        });

        container.appendChild(btn);
      });

      row.style.display = "";
    }




    /* =========================
       ë Œë”
    ========================== */

    function render() {
      const root = $("#listRoot");
      root.classList.remove("cols-1", "cols-2", "cols-3");
      root.classList.add(`cols-${layoutCols}`);
      root.innerHTML = "";

      // ğŸ”¹ ì‹¤ì œ ìœ ì € ë§í¬ê°€ í•˜ë‚˜ë¼ë„ ìˆëŠ”ì§€ í™•ì¸
      const hasRealArticle = articles.some(a => Number(a.is_demo) === 0);

      // ğŸ”¹ íƒ­ í•„í„°ê°€ ì„ íƒë˜ì—ˆë‹¤ë©´
      let list = articles.filter(a => {
        if (hasRealArticle && Number(a.is_demo) === 1) return false;

        const tabMatch =
          (a.status === "1" && activeTab === "UNREAD") ||
          (a.status === "0" && activeTab === "read");

        if (!tabMatch) return false;

        // ğŸ”¹ íƒœê·¸ í•„í„°ê°€ ì¼œì ¸ ìˆê³ , activeTagsForFilterê°€ ë¹„ì–´ ìˆì§€ ì•Šë‹¤ë©´
        if (tagFilterActive && activeTagsForFilter.size > 0) {
          const tags = a.tags || [];
          // ë¬¸ì„œì˜ íƒœê·¸ë“¤ ì¤‘ í•˜ë‚˜ë¼ë„ activeTagsì— ìˆìœ¼ë©´ í†µê³¼
          const hasActive = tags.some(t => activeTagsForFilter.has(t));
          if (!hasActive) return false;
        }

        return true;
      });

      const filtered = sortArticles(list);

      $("#emptyState").classList.toggle("d-none", filtered.length !== 0);
      $("#emptyTitle").innerText = activeTab === "UNREAD" ? "ì•„ì§ ì €ì¥í•œ ê¸€ì´ ì—†ì–´ìš”" : "ì½ì€ ê¸€ì´ ì—†ì–´ìš”";

      filtered.forEach(a => {
        const card = document.createElement("div");
        card.className = "doc-card p-4";

        const tagsHtml = (a.tags || []).slice(0, 3).map(t =>
          `<span class="tag ${tagClass(t)}">${t}</span>`
        ).join(" ");

        card.innerHTML = `
          <div class="d-flex flex-column flex-xl-row gap-3">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2 mb-2">
                <i class="bi-globe text-muted"></i>
                <span class="text-muted small">${host(a.url)}</span>
                <div class="ms-1 d-flex gap-1 flex-wrap">${tagsHtml}</div>
              </div>
              <h5 class="mb-2">
                <a class="text-decoration-none" target="_blank" rel="noopener noreferrer" href="${a.url}">${a.title}</a>
              </h5>
              <p class="text-muted mb-3">${a.summary}</p>
              <div class="d-flex gap-3 small text-muted">
                <span>ì¶”ê°€: ${a.added_at}</span>
                ${a.remind_at ? `<span>ë¦¬ë§ˆì¸ë“œ: ${a.remind_at}</span>` : ``}
              </div>
            </div>

            <div class="d-flex flex-xl-column gap-2">
              <a class="btn btn-outline-primary btn-round action-btn" target="_blank" rel="noopener noreferrer" href="${a.url}">
                <i class="bi-box-arrow-up-right me-1"></i>ì—´ê¸°
              </a>

              ${a.status === "1"
            ? `<button class="btn btn-primary btn-round action-btn" data-act="read"><i class="bi-check2 me-1"></i>ì½ìŒìœ¼ë¡œ í‘œì‹œ</button>`
            : `<button class="btn btn-danger btn-round action-btn" data-act="delete"><i class="bi-trash me-1"></i>ë¬¸ì„œ ì‚­ì œ</button>`
          }

              <button class="btn btn-outline-secondary btn-round action-btn" data-act="copy"><i class="bi-clipboard me-1"></i>ë³µì‚¬</button>
            </div>
          </div>
        `;

        const secondBtn = card.querySelector('[data-act="read"],[data-act="delete"]');
        if (secondBtn) {
          if (a.status === "1") secondBtn.addEventListener("click", () => markAsRead(a.id));
          else secondBtn.addEventListener("click", () => softDelete(a.id));
        }
        const copyBtn = card.querySelector('[data-act="copy"]');
        copyBtn.addEventListener("click", (e) => copyUrl(a.url, e.currentTarget));

        root.appendChild(card);
      });

      // í† ê¸€ UI sync
      $$("#tabToggle .btn").forEach(b => b.classList.toggle("active", b.dataset.tab === activeTab));
      $$("#sortToggle .btn").forEach(b => b.classList.toggle("active", b.dataset.sort === sortMode));
      $$("#viewToggle .btn").forEach(b => b.classList.toggle("active", Number(b.dataset.cols) === layoutCols));
    }

    /* =========================
       ì´ë²¤íŠ¸ ë°”ì¸ë”©
    ========================== */

    $("#addBtn").addEventListener("click", addArticle);

    $$("#tabToggle .btn").forEach(btn => btn.addEventListener("click", () => {
      activeTab = btn.dataset.tab; render();
    }));
    // $$("#sortToggle .btn").forEach(btn => btn.addEventListener("click", () => {
    //   sortMode = btn.dataset.sort; render();
    // }));
    $$("#viewToggle .btn").forEach(btn => btn.addEventListener("click", () => {
      layoutCols = Number(btn.dataset.cols); render();
    }));

    // ì´ˆê¸° ë¡œë“œ
    loadArticlesFromServer();

  </script>
</body>

</html>